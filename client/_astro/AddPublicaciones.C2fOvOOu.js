import{d as k,b as M,e as h,j as T,y as I,o as C,c as P,k as Y,l as s,n as d,w as n,a,g as b,t as c,v as D,m as v,f as V,K as E,p,L as F,s as L,F as q,i as B,x as K}from"./index.KfEE4HSd.js";import{a as A,u as N}from"./http.DBesh0fB.js";import{a as R,s as z}from"./index.DnwL9gBf.js";import{s as O,v as G}from"./index.BmYimniB.js";import{f as H}from"./format.DImkLxIw.js";/* empty css                       */import{_ as j}from"./_plugin-vue_export-helper.DlAUqK2U.js";import"./utils.DAH0eC5i.js";import"./index.BxwS7znj.js";import"./moment.C5S46NFB.js";const J=k({__name:"ListaPublicaciones",props:{data:{},isPending:{type:Boolean},mutationUpdate:{},miembros:{}},setup(S,{expose:t}){t();const x=S,e=M(!1),y=h(()=>x?.miembros.map(r=>({label:r.nombreCompleto,value:r.idmiembro}))??[]),m=M([]),o=r=>{e:{const{data:u,newValue:i,field:f}=r;if(f==="miembrosCol"){if(u[f]!==F(m.value)){const g=new Set(u[f]),w=new Set(F(m.value)),_=g.difference(w),U=w.difference(g);x.mutationUpdate.mutate({idpublicacion:u.idpublicacion,miembrosColabAdd:Array.from(U),miembrosColabDelete:Array.from(_)})}break e}i!==u[f]&&x.mutationUpdate.mutate({idpublicacion:u.idpublicacion,[f]:i});break e}};T(()=>{e.value=!0}),I(()=>{e.value=!1});const l={props:x,isMounted:e,miembros:y,colaboradores:m,handleEdit:o,get DataTable(){return R},get Column(){return z},get MultiSelect(){return O},get formatDate(){return H}};return Object.defineProperty(l,"__isScriptSetup",{enumerable:!1,value:!0}),l}}),Q={key:0,class:"skeleton h-96 w-full"},W=["onUpdate:modelValue"],X={class:"w-60"},Z=["onUpdate:modelValue"],$={class:"badge badge-info h-max"},ee=["onUpdate:modelValue"],oe={class:"flex gap-4 items-center mb-4"},ae=["onSubmit"],te=["onSubmit"],le=["onUpdate:modelValue"],re=["onUpdate:modelValue"],se=["onUpdate:modelValue"],ie=["onUpdate:modelValue"];function ne(S,t,x,e,y,m){return e.isMounted?(C(),Y(e.DataTable,{key:1,class:p({"skeleton select-none":e.props.isPending,"cursor-wait select-none":e.props.mutationUpdate.isPending.value}),value:e.props.data,paginator:!0,rows:5,"edit-mode":"cell",onCellEditComplete:e.handleEdit},{default:s(()=>[d(e.Column,{field:"ISSN",header:"ISSN"},{editor:s(({data:o,field:l})=>[n(a("input",{"onUpdate:modelValue":r=>o[l]=r,type:"text",class:"input input-bordered w-full max-w-xs"},null,8,W),[[b,o[l]]])]),_:1}),d(e.Column,{field:"titulo",header:"Titulo de la publicación"},{body:s(({data:o,field:l})=>[a("div",X,c(o[l]),1)]),editor:s(({data:o,field:l})=>[n(a("textarea",{"onUpdate:modelValue":r=>o[l]=r,class:"textarea textarea-bordered h-24"},null,8,Z),[[b,o[l]]])]),_:1}),d(e.Column,{field:"tipo",header:"Tipo",sortable:""},{body:s(({data:o,field:l})=>[a("div",$,c(o[l].toUpperCase()),1)]),editor:s(({data:o,field:l})=>[n(a("select",{"onUpdate:modelValue":r=>o[l]=r,class:"select select-bordered w-full max-w-xs"},t[3]||(t[3]=[a("option",{disabled:"",selected:""},"Selecciona un tipo",-1),a("option",{value:"arbitrado"},"Arbitrado",-1),a("option",{value:"memoria en extenso"},"Memoria en extenso",-1)]),8,ee),[[D,o[l]]])]),_:1}),d(e.Column,{field:"miembrosCol",header:"Miembros autores"},{body:s(({data:o})=>[v(c(o.miembros_publicacion.map(l=>l.nombreCompleto).join(",")),1)]),editor:s(({data:o,field:l,editorSaveCallback:r,editorCancelCallback:u})=>[a("div",oe,[a("form",{onSubmit:V(u,["prevent"])},t[4]||(t[4]=[a("button",{type:"submit",class:"btn btn-error btn-xs"},"Cancelar",-1)]),40,ae),a("form",{onSubmit:V(r,["prevent"])},t[5]||(t[5]=[a("button",{type:"submit",class:"btn btn-primary btn-xs"},"Guardar",-1)]),40,te)]),d(e.MultiSelect,{modelValue:e.colaboradores,"onUpdate:modelValue":t[0]||(t[0]=i=>e.colaboradores=i),onVnodeMounted:i=>e.colaboradores=o[l],options:e.miembros,"option-label":"label","option-value":"value",display:"chip",filter:"",onKeydown:[t[1]||(t[1]=E(V(()=>{},["stop"]),["enter"])),t[2]||(t[2]=E(V(()=>{},["stop"]),["escape"]))]},null,8,["modelValue","onVnodeMounted","options"])]),_:1}),d(e.Column,{field:"otrosAutores",header:"Otros autores"},{body:s(({data:o,field:l})=>[v(c(o[l]??"---"),1)]),editor:s(({data:o,field:l})=>[n(a("textarea",{"onUpdate:modelValue":r=>o[l]=r,class:"textarea textarea-bordered h-24"},null,8,le),[[b,o[l]]])]),_:1}),d(e.Column,{field:"descripcion",header:"Descripción"},{body:s(({data:o,field:l})=>[v(c(o[l]??"--."),1)]),editor:s(({data:o,field:l})=>[n(a("textarea",{"onUpdate:modelValue":r=>o[l]=r,class:"textarea textarea-bordered h-24"},null,8,re),[[b,o[l]]])]),_:1}),d(e.Column,{field:"url",header:"URL (DOI u otro)"},{body:s(({data:o,field:l})=>[v(c(o[l]??"--."),1)]),editor:s(({data:o,field:l})=>[n(a("textarea",{"onUpdate:modelValue":r=>o[l]=r,class:"textarea textarea-bordered h-24"},null,8,se),[[b,o[l]]])]),_:1}),d(e.Column,{field:"visible",header:"Visibilidad de la publicación",sortable:""},{body:s(({data:o,field:l})=>[a("div",{class:p(["badge h-max",{"badge-success":o[l],"badge-error":!o[l]}])},c(o[l]?"Visible":"No visible"),3)]),editor:s(({data:o,field:l})=>[n(a("select",{"onUpdate:modelValue":r=>o[l]=r,class:"select select-bordered w-full max-w-xs"},t[6]||(t[6]=[a("option",{disabled:"",selected:"",value:""},"Selecciona una visibilidad",-1),a("option",{value:!0},"Visible",-1),a("option",{value:!1},"No visible",-1)]),8,ie),[[D,o[l]]])]),_:1}),d(e.Column,{field:"createdAt",header:"Fecha de creación",sortable:""},{body:s(({data:o,field:l})=>[v(c(e.formatDate(o[l],"DD-MM-YYYY")),1)]),_:1}),d(e.Column,{field:"updatedAt",header:"Ultima actualización",sortable:""},{body:s(({data:o,field:l})=>[v(c(e.formatDate(o[l],"DD-MM-YYYY")),1)]),_:1})]),_:1},8,["class","value"])):(C(),P("div",Q))}const de=j(J,[["render",ne]]),be=k({__name:"AddPublicaciones",setup(S,{expose:t}){t();const x=new G,{data:e,isPending:y,refetch:m}=A("publicaciones","publicacionesData"),{data:o}=A("miembros","miembrosData"),l=M(!1),r=N("publicaciones","post",{onSuccess(){i.titulo="",i.ISSN="",i.descripcion="",i.year="",i.url="",i.miembrosColaboradores=[],i.tipo="",m()}}),u=N("publicaciones","put",{onSuccess(){m()}}),i=B({titulo:"",ISSN:"",descripcion:"",year:"",url:"",miembrosColaboradores:[],visible:!0,tipo:""}),f=h(()=>e.value?.response.map(_=>({..._,miembrosCol:_.miembros_publicacion.map(U=>U.idmiembro)}))??[]),w={validator:x,data:e,isPending:y,refetch:m,miembros:o,noMiembrosColab:l,addPublicacion:r,updatePublicaciones:u,body:i,proyectos:f,handleSubmit:()=>{e:{if(i.miembrosColaboradores.length>0&&(l.value=!1),i.miembrosColaboradores.length<1){l.value=!0,K.error("No seleccionaste ningun miembro colaborador.");break e}r.mutate(i);break e}},ListaPublicaciones:de,get MultiSelect(){return O}};return Object.defineProperty(w,"__isScriptSetup",{enumerable:!1,value:!0}),w}}),me={class:"form-control w-full max-w-xs h-full row-span-2"},ue={class:"form-control w-full max-w-xs h-full row-span-2"},ce={class:"form-control w-full max-w-xs"},pe={class:"form-control w-full max-w-xs"},xe={class:"form-control w-full max-w-xs"},fe={class:"form-control w-full max-w-xs"},ve={class:"form-control w-full max-w-xs"},ye={class:"w-full max-w-xs"},we={class:"label"},Ve={key:0,class:"label-text-alt text-error"};function Se(S,t,x,e,y,m){return C(),P(q,null,[a("form",{class:"mb-4 grid grid-cols-4 grid-rows-3 gap-4 items-end",onSubmit:V(e.handleSubmit,["prevent"])},[a("label",me,[t[8]||(t[8]=a("div",{class:"label"},[a("span",{class:"label-text"},"Titulo")],-1)),n(a("textarea",{"onUpdate:modelValue":t[0]||(t[0]=o=>e.body.titulo=o),class:p(["textarea textarea-bordered h-full",{"textarea-error":e.validator.setErrorObject(e.addPublicacion.error.value).setField("titulo").getValidator().isError()}]),required:""},null,2),[[b,e.body.titulo]])]),a("label",ue,[t[9]||(t[9]=a("div",{class:"label"},[a("span",{class:"label-text"},"Descripción")],-1)),n(a("textarea",{"onUpdate:modelValue":t[1]||(t[1]=o=>e.body.descripcion=o),class:p(["textarea textarea-bordered h-full",{"textarea-error":e.validator.setErrorObject(e.addPublicacion.error.value).setField("titulo").getValidator().isError()}]),required:""},null,2),[[b,e.body.descripcion]])]),a("label",ce,[t[10]||(t[10]=a("div",{class:"label"},[a("span",{class:"label-text"},"ISSN")],-1)),n(a("input",{type:"text","onUpdate:modelValue":t[2]||(t[2]=o=>e.body.ISSN=o),class:p(["input input-bordered w-full max-w-xs",{"input-error":e.validator.setErrorObject(e.addPublicacion.error.value).setField("clave").getValidator().isError()}]),required:""},null,2),[[b,e.body.ISSN]])]),a("label",pe,[t[11]||(t[11]=a("div",{class:"label"},[a("span",{class:"label-text"},"Otros autores"),a("span",{class:"label-text-alt"},'Separar con ";"')],-1)),n(a("input",{type:"text","onUpdate:modelValue":t[3]||(t[3]=o=>e.body.otrosAutores=o),class:p(["input input-bordered w-full max-w-xs",{"input-error":e.validator.setErrorObject(e.addPublicacion.error.value).setField("clave").getValidator().isError()}])},null,2),[[b,e.body.otrosAutores]])]),a("label",xe,[t[12]||(t[12]=a("div",{class:"label"},[a("span",{class:"label-text"},"Año de publicación")],-1)),n(a("input",{type:"text","onUpdate:modelValue":t[4]||(t[4]=o=>e.body.year=o),class:p(["input input-bordered w-full max-w-xs",{"input-error":e.validator.setErrorObject(e.addPublicacion.error.value).setField("clave").getValidator().isError()}]),required:""},null,2),[[b,e.body.year]])]),a("label",fe,[t[13]||(t[13]=a("div",{class:"label"},[a("span",{class:"label-text"},"URL (doi, etc.)")],-1)),n(a("input",{type:"text","onUpdate:modelValue":t[5]||(t[5]=o=>e.body.url=o),class:p(["input input-bordered w-full max-w-xs",{"input-error":e.validator.setErrorObject(e.addPublicacion.error.value).setField("clave").getValidator().isError()}]),required:""},null,2),[[b,e.body.url]])]),a("label",ve,[t[15]||(t[15]=a("div",{class:"label"},[a("span",{class:"label-text"},"Estatus")],-1)),n(a("select",{class:"select select-bordered","onUpdate:modelValue":t[6]||(t[6]=o=>e.body.tipo=o),required:""},t[14]||(t[14]=[a("option",{disabled:"",selected:"",value:""},"Selecciona un tipo",-1),a("option",{value:"arbitrado"},"Arbitrado",-1),a("option",{value:"memoria en extenso"},"Memoria en extenso",-1)]),512),[[D,e.body.tipo]])]),a("div",ye,[a("div",we,[t[16]||(t[16]=a("span",{class:"label-text"},"Miembros colaboradores",-1)),e.noMiembrosColab?(C(),P("span",Ve,"**")):L("",!0)]),d(e.MultiSelect,{modelValue:e.body.miembrosColaboradores,"onUpdate:modelValue":t[7]||(t[7]=o=>e.body.miembrosColaboradores=o),display:"chip",options:e.miembros?.response,optionLabel:"nombreCompleto","option-value":"idmiembro",filter:"",placeholder:"Selecciona uno o más miembros","max-selected-labels":2,class:p({"input-error":e.noMiembrosColab||e.validator.setErrorObject(e.addPublicacion.error.value).setField("miembrosColaboradores").getValidator().isError()})},null,8,["modelValue","options","class"])]),t[17]||(t[17]=a("button",{class:"btn btn-primary"},"Añadir publicación",-1))],32),d(e.ListaPublicaciones,{data:e.proyectos??[],"is-pending":e.isPending,miembros:e.miembros?.response??[],"mutation-update":e.updatePublicaciones},null,8,["data","is-pending","miembros","mutation-update"])],64)}const Ne=j(be,[["render",Se]]);export{Ne as default};
