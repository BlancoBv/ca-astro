import{d as k,b as h,e as z,h as B,i as L,K as N,o as b,c as f,k as d,f as K,g as n,w as s,a as t,j as m,t as c,n as x,v as V,l as p,F as E,r as j,m as M,L as Y,M as F,x as G,q as H,y as R}from"./index.B-m58UHt.js";import{a as I,u as T}from"./http.CQBKhH2u.js";import{s as A,v as J}from"./index.dQ8ElfNT.js";import{a as Q,s as W}from"./index.BeSFXW5K.js";import{s as X}from"./index.Dc8RBPX8.js";import{f as Z,a as $}from"./format.DRaPJfrL.js";/* empty css                       */import{_ as O}from"./_plugin-vue_export-helper.DlAUqK2U.js";import"./utils.BVq-FYmo.js";import"./index.qeFD9Kla.js";import"./moment.C5S46NFB.js";const ee=k({__name:"ListaProyectos",props:{data:{},isPending:{type:Boolean},mutationUpdate:{},miembros:{},refetch:{}},setup(D,{expose:l}){l();const y=D,o=h(null),v=h(!1),w=h([{label:"Eliminar",icon:"bi bi-trash-fill",command:()=>{}}]),g=z(()=>y?.miembros.map(i=>({label:i.nombreCompleto,value:i.idmiembro}))??[]),e=h([]),a=i=>{e:{const{data:u,newValue:S,field:C}=i;if(C==="miembrosCol"){if(u[C]!==F(e.value)){const U=new Set(u[C]),_=new Set(F(e.value)),P=U.difference(_),q=_.difference(U);y.mutationUpdate.mutate({idproyecto:u.idproyecto,miembrosColabAdd:Array.from(q),miembrosColabDelete:Array.from(P)})}break e}S!==u[C]&&y.mutationUpdate.mutate({idproyecto:u.idproyecto,[C]:S});break e}};B(()=>{v.value=!0}),L(()=>{v.value=!1});const r={props:y,selectedItem:o,isMounted:v,items:w,miembros:g,colaboradores:e,handleEdit:a,get DataTable(){return Q},get Column(){return W},get MultiSelect(){return A},get ContextMenu(){return X},get formatDate(){return Z},get formatMoneda(){return $}};return Object.defineProperty(r,"__isScriptSetup",{enumerable:!1,value:!0}),r}}),oe={key:0,class:"skeleton h-96 w-full"},te=["onUpdate:modelValue"],le={class:"w-60"},ae=["onUpdate:modelValue"],re=["onUpdate:modelValue"],ne=["onUpdate:modelValue"],se=["value"],ie={class:"flex gap-4 items-center mb-4"},de=["onSubmit"],me=["onSubmit"],ce=["onUpdate:modelValue"],be=["onUpdate:modelValue"],ue=["onUpdate:modelValue"],pe=["onUpdate:modelValue"],fe=["onUpdate:modelValue"],xe=["onUpdate:modelValue","min"],ye=["onUpdate:modelValue"],ve=["onUpdate:modelValue"],we=["onUpdate:modelValue","min"];function ge(D,l,y,o,v,w){const g=N("uppercase");return b(),f(E,null,[d(o.ContextMenu,{ref:"cm",model:o.items,onHide:l[0]||(l[0]=e=>o.selectedItem=null)},null,8,["model"]),o.isMounted?(b(),K(o.DataTable,{key:1,class:x({"skeleton select-none":o.props.isPending,"cursor-wait select-none":o.props.mutationUpdate.isPending.value}),value:o.props.data,paginator:!0,rows:5,"edit-mode":"cell",onCellEditComplete:o.handleEdit},{default:n(()=>[d(o.Column,{field:"clave",header:"Clave del proyecto",sortable:""},{editor:n(({data:e,field:a})=>[s(t("input",{"onUpdate:modelValue":r=>e[a]=r,type:"text",class:"input input-bordered w-full max-w-xs"},null,8,te),[[m,e[a]]])]),_:1}),d(o.Column,{field:"titulo",header:"Titulo del proyecto"},{body:n(({data:e,field:a})=>[t("div",le,c(e[a]),1)]),editor:n(({data:e,field:a})=>[s(t("textarea",{"onUpdate:modelValue":r=>e[a]=r,class:"textarea textarea-bordered h-24"},null,8,ae),[[m,e[a]]])]),_:1}),d(o.Column,{field:"tipo",header:"Tipo de proyecto",sortable:""},{body:n(({data:e,field:a})=>[t("div",{class:x(["badge h-max",{"badge-accent":e[a]==="externo","badge-info":e[a]!=="externo"}])},c(e[a].toUpperCase()),3)]),editor:n(({data:e,field:a})=>[s(t("select",{"onUpdate:modelValue":r=>e[a]=r,class:"select select-bordered w-full max-w-xs"},l[4]||(l[4]=[t("option",{disabled:"",selected:""},"Selecciona un tipo",-1),t("option",{value:"interno"},"Interno",-1),t("option",{value:"externo"},"Externo",-1)]),8,re),[[V,e[a]]])]),_:1}),d(o.Column,{field:"director",header:"Director(a) responsable del proyecto"},{body:n(({data:e})=>[p(c(e.director_proyecto.nombreCompleto),1)]),editor:n(({data:e,field:a})=>[s(t("select",{"onUpdate:modelValue":r=>e[a]=r,class:"select select-bordered w-full max-w-xs"},[l[5]||(l[5]=t("option",{disabled:"",selected:"",value:""},"Selecciona un miembro",-1)),(b(!0),f(E,null,j(o.props.miembros,r=>(b(),f("option",{value:r.idmiembro},c(r.nombreCompleto),9,se))),256))],8,ne),[[V,e[a]]])]),_:1}),d(o.Column,{field:"miembrosCol",header:"Miembros colaboradores"},{body:n(({data:e})=>[p(c(e.miembros_proyecto.map(a=>a.nombreCompleto).join(",")),1)]),editor:n(({data:e,field:a,editorSaveCallback:r,editorCancelCallback:i})=>[t("div",ie,[t("form",{onSubmit:M(i,["prevent"])},l[6]||(l[6]=[t("button",{type:"submit",class:"btn btn-error btn-xs"},"Cancelar",-1)]),40,de),t("form",{onSubmit:M(r,["prevent"])},l[7]||(l[7]=[t("button",{type:"submit",class:"btn btn-primary btn-xs"},"Guardar",-1)]),40,me)]),d(o.MultiSelect,{modelValue:o.colaboradores,"onUpdate:modelValue":l[1]||(l[1]=u=>o.colaboradores=u),onVnodeMounted:u=>o.colaboradores=e[a],options:o.miembros,"option-label":"label","option-value":"value",display:"chip",filter:"",onKeydown:[l[2]||(l[2]=Y(M(()=>{},["stop"]),["enter"])),l[3]||(l[3]=Y(M(()=>{},["stop"]),["escape"]))]},null,8,["modelValue","onVnodeMounted","options"])]),_:1}),d(o.Column,{field:"otrosColaboradores",header:"Otros colaboradores"},{body:n(({data:e,field:a})=>[p(c(e[a]??"---"),1)]),editor:n(({data:e,field:a})=>[s(t("textarea",{"onUpdate:modelValue":r=>e[a]=r,class:"textarea textarea-bordered h-24"},null,8,ce),[[m,e[a]]])]),_:1}),d(o.Column,{field:"estatus",header:"Estatus del proyecto",sortable:""},{body:n(({data:e,field:a})=>[t("div",{class:x(["badge h-max",{"badge-warning":e[a]==="en proceso","badge-success":e[a]==="finalizado","badge-error":e[a]==="no finalizado"}])},c(e[a].toUpperCase()),3)]),editor:n(({data:e,field:a})=>[s(t("select",{"onUpdate:modelValue":r=>e[a]=r,class:"select select-bordered w-full max-w-xs"},l[8]||(l[8]=[t("option",{disabled:"",selected:"",value:""},"Selecciona un estatus",-1),t("option",{value:"en proceso"},"En proceso",-1),t("option",{value:"finalizado"},"Finalizado",-1),t("option",{value:"no finalizado"},"No finalizado",-1)]),8,be),[[V,e[a]]])]),_:1}),d(o.Column,{field:"monto",header:"Monto del proyecto",sortable:""},{body:n(({data:e,field:a})=>[p(c(o.formatMoneda(e[a])),1)]),editor:n(({data:e,field:a})=>[s(t("input",{"onUpdate:modelValue":r=>e[a]=r,type:"number",step:"0.01",min:"0",class:"input input-bordered w-full max-w-xs"},null,8,ue),[[m,e[a]]])]),_:1}),d(o.Column,{field:"convocatoria",header:"Convocatoria"},{editor:n(({data:e,field:a})=>[s(t("input",{"onUpdate:modelValue":r=>e[a]=r,type:"text",class:"input input-bordered w-full max-w-xs"},null,8,pe),[[m,e[a]],[g]])]),_:1}),d(o.Column,{field:"fechaInicio",header:"Fecha de inicio del proyecto",sortable:""},{body:n(({data:e,field:a})=>[p(c(o.formatDate(e[a],"DD-MM-YYYY")),1)]),editor:n(({data:e,field:a})=>[s(t("input",{"onUpdate:modelValue":r=>e[a]=r,type:"date",class:"input input-bordered w-full max-w-xs"},null,8,fe),[[m,e[a]]])]),_:1}),d(o.Column,{field:"fechaTermino",header:"Fecha de termino del proyecto",sortable:""},{body:n(({data:e,field:a})=>[p(c(o.formatDate(e[a],"DD-MM-YYYY")),1)]),editor:n(({data:e,field:a})=>[s(t("input",{"onUpdate:modelValue":r=>e[a]=r,type:"date",min:e.fechaInicio,class:"input input-bordered w-full max-w-xs"},null,8,xe),[[m,e[a]]])]),_:1}),d(o.Column,{field:"visible",header:"Visibilidad del proyecto"},{body:n(({data:e,field:a})=>[t("div",{class:x(["badge h-max",{"badge-success":e[a],"badge-error":!e[a]}])},c(e[a]?"Visible":"No visible"),3)]),editor:n(({data:e,field:a})=>[s(t("select",{"onUpdate:modelValue":r=>e[a]=r,class:"select select-bordered w-full max-w-xs"},l[9]||(l[9]=[t("option",{disabled:"",selected:"",value:""},"Selecciona una visibilidad",-1),t("option",{value:!0},"Visible",-1),t("option",{value:!1},"No visible",-1)]),8,ye),[[V,e[a]]])]),_:1}),d(o.Column,{field:"fechaInicioEntrega",header:"Fecha de inicio de entrega final",sortable:""},{body:n(({data:e,field:a})=>[p(c(e[a]?o.formatDate(e[a],"DD-MM-YYYY"):"---"),1)]),editor:n(({data:e,field:a})=>[s(t("input",{"onUpdate:modelValue":r=>e[a]=r,type:"date",class:"input input-bordered w-full max-w-xs"},null,8,ve),[[m,e[a]]])]),_:1}),d(o.Column,{field:"fechaTerminoEntrega",header:"Fecha de termino de entrega final",sortable:""},{body:n(({data:e,field:a})=>[p(c(e[a]?o.formatDate(e[a],"DD-MM-YYYY"):"---"),1)]),editor:n(({data:e,field:a})=>[s(t("input",{"onUpdate:modelValue":r=>e[a]=r,type:"date",min:e.fechaInicioEntrega,class:"input input-bordered w-full max-w-xs"},null,8,we),[[m,e[a]]])]),_:1}),d(o.Column,{field:"createdAt",header:"Fecha de creaci칩n",sortable:""},{body:n(({data:e,field:a})=>[p(c(o.formatDate(e[a],"DD-MM-YYYY")),1)]),_:1}),d(o.Column,{field:"updatedAt",header:"Ultima actualizaci칩n",sortable:""},{body:n(({data:e,field:a})=>[p(c(o.formatDate(e[a],"DD-MM-YYYY")),1)]),_:1})]),_:1},8,["class","value"])):(b(),f("div",oe))],64)}const Ve=O(ee,[["render",ge]]),Ce=k({__name:"AddProyecto",setup(D,{expose:l}){l();const{data:y,isPending:o,refetch:v}=I("proyectos","proyectosData"),w=h(!1),{data:g,isPending:e}=I("miembros","miembrosData"),a=T("proyectos","post",{onSuccess(){v(),i.miembrosColaboradores=[],i.titulo="",i.clave="",i.fechaInicio="",i.fechaTermino="",i.estatus="",i.tipo="",i.otrosColaboradores="",i.director="",i.monto="",i.fechaInicioEntrega="",i.fechaTerminoEntrega="",i.convocatoria=""}}),r=T("proyectos","put",{onSuccess(){v()}}),i=H({miembrosColaboradores:[],titulo:"",clave:"",fechaInicio:"",fechaTermino:"",estatus:"",tipo:"",director:"",monto:"",fechaInicioEntrega:"",fechaTerminoEntrega:"",convocatoria:"",visible:!0}),u=z(()=>y.value?.response.map(_=>({..._,director:_.director_proyecto.idmiembro,miembrosCol:_.miembros_proyecto.map(P=>P.idmiembro)}))??[]),S=new J,U={data:y,isPending:o,refetch:v,noMiembrosColab:w,miembros:g,miembrosIsPending:e,addProyecto:a,updateProyecto:r,body:i,proyectos:u,validator:S,handleSubmit:()=>{e:{if(i.miembrosColaboradores.length>0&&(w.value=!1),i.miembrosColaboradores.length<1){w.value=!0,R.error("No seleccionaste ningun miembro colaborador.");break e}a.mutate(i);break e}},ListaProyectos:Ve,get MultiSelect(){return A}};return Object.defineProperty(U,"__isScriptSetup",{enumerable:!1,value:!0}),U}}),_e={class:"form-control w-full max-w-xs h-full row-span-2"},Ue={class:"form-control w-full max-w-xs"},he={class:"form-control w-full max-w-xs"},Me={class:"form-control w-full max-w-xs"},Ee=["min"],De={class:"form-control w-full max-w-xs"},Se={class:"form-control w-full max-w-xs"},Pe={class:"form-control w-full max-w-xs"},Ye={class:"form-control w-full max-w-xs"},Fe={key:0,disabled:"",selected:"",value:""},Ie=["value"],Te={class:"form-control w-full max-w-xs"},ke={class:"form-control w-full max-w-xs"},ze={class:"form-control w-full max-w-xs"},Ne=["min"],je={class:"form-control w-full max-w-xs"},Ae={class:"w-full max-w-xs"},Oe={class:"label"},qe={key:0,class:"label-text-alt text-error"},Be=["disabled"];function Le(D,l,y,o,v,w){const g=N("uppercase");return b(),f(E,null,[t("form",{class:"mb-4 grid grid-cols-4 grid-rows-3 gap-4 items-end",onSubmit:M(o.handleSubmit,["prevent"])},[t("label",_e,[l[13]||(l[13]=t("div",{class:"label"},[t("span",{class:"label-text"},"Titulo del proyecto")],-1)),s(t("textarea",{"onUpdate:modelValue":l[0]||(l[0]=e=>o.body.titulo=e),class:x(["textarea textarea-bordered h-full",{"textarea-error":o.validator.setErrorObject(o.addProyecto.error.value).setField("titulo").getValidator().isError()}]),required:""},null,2),[[m,o.body.titulo]])]),t("label",Ue,[l[14]||(l[14]=t("div",{class:"label"},[t("span",{class:"label-text"},"Clave")],-1)),s(t("input",{type:"text","onUpdate:modelValue":l[1]||(l[1]=e=>o.body.clave=e),class:x(["input input-bordered w-full max-w-xs",{"input-error":o.validator.setErrorObject(o.addProyecto.error.value).setField("clave").getValidator().isError()}]),required:""},null,2),[[m,o.body.clave]])]),t("label",he,[l[15]||(l[15]=t("div",{class:"label"},[t("span",{class:"label-text"},"Fecha de inicio")],-1)),s(t("input",{type:"date","onUpdate:modelValue":l[2]||(l[2]=e=>o.body.fechaInicio=e),class:"input input-bordered w-full max-w-xs",required:""},null,512),[[m,o.body.fechaInicio]])]),t("label",Me,[l[16]||(l[16]=t("div",{class:"label"},[t("span",{class:"label-text"},"Fecha de termino")],-1)),s(t("input",{type:"date",min:o.body.fechaInicio,"onUpdate:modelValue":l[3]||(l[3]=e=>o.body.fechaTermino=e),class:"input input-bordered w-full max-w-xs"},null,8,Ee),[[m,o.body.fechaTermino]])]),t("label",De,[l[17]||(l[17]=t("div",{class:"label"},[t("span",{class:"label-text"},"Monto del proyecto")],-1)),s(t("input",{type:"number",placeholder:"50.00",step:"0.01",min:"0.00","onUpdate:modelValue":l[4]||(l[4]=e=>o.body.monto=e),class:"input input-bordered w-full max-w-xs",required:""},null,512),[[m,o.body.monto]])]),t("label",Se,[l[19]||(l[19]=t("div",{class:"label"},[t("span",{class:"label-text"},"Estatus")],-1)),s(t("select",{class:"select select-bordered","onUpdate:modelValue":l[5]||(l[5]=e=>o.body.estatus=e),required:""},l[18]||(l[18]=[t("option",{disabled:"",selected:"",value:""},"Selecciona un estatus",-1),t("option",{value:"en proceso"},"En proceso",-1),t("option",{value:"finalizado"},"Finalizado",-1),t("option",{value:"no finalizado"},"No finalizado",-1)]),512),[[V,o.body.estatus]])]),t("label",Pe,[l[21]||(l[21]=t("div",{class:"label"},[t("span",{class:"label-text"},"Tipo de proyecto")],-1)),s(t("select",{class:"select select-bordered","onUpdate:modelValue":l[6]||(l[6]=e=>o.body.tipo=e),required:""},l[20]||(l[20]=[t("option",{disabled:"",selected:"",value:""},"Selecciona un tipo",-1),t("option",{value:"interno"},"Interno",-1),t("option",{value:"externo"},"Externo",-1)]),512),[[V,o.body.tipo]])]),t("label",Ye,[l[23]||(l[23]=t("div",{class:"label"},[t("span",{class:"label-text"},"Director")],-1)),s(t("select",{class:x(["select select-bordered",{skeleton:o.miembrosIsPending}]),"onUpdate:modelValue":l[7]||(l[7]=e=>o.body.director=e),required:""},[o.miembrosIsPending?(b(),f("option",Fe," Cargando miembros... ")):(b(),f(E,{key:1},[l[22]||(l[22]=t("option",{disabled:"",selected:"",value:""},"Selecciona un miembro",-1)),(b(!0),f(E,null,j(o.miembros.response,e=>(b(),f("option",{value:e.idmiembro},c(e.nombreCompleto),9,Ie))),256))],64))],2),[[V,o.body.director]])]),t("label",Te,[l[24]||(l[24]=t("div",{class:"label"},[t("span",{class:"label-text"},"Otros colaboradores"),t("span",{class:"label-text-alt"},'Separar con ";"')],-1)),s(t("input",{type:"text","onUpdate:modelValue":l[8]||(l[8]=e=>o.body.otrosColaboradores=e),class:x(["input input-bordered w-full max-w-xs",{"input-error":o.validator.setErrorObject(o.addProyecto.error.value).setField("otrosColaboradores").getValidator().isError()}])},null,2),[[m,o.body.otrosColaboradores]])]),t("label",ke,[l[25]||(l[25]=t("div",{class:"label"},[t("span",{class:"label-text"},"Fecha de inicio de entrega")],-1)),s(t("input",{type:"date","onUpdate:modelValue":l[9]||(l[9]=e=>o.body.fechaInicioEntrega=e),class:"input input-bordered w-full max-w-xs"},null,512),[[m,o.body.fechaInicioEntrega]])]),t("label",ze,[l[26]||(l[26]=t("div",{class:"label"},[t("span",{class:"label-text"},"Fecha de termino de entrega")],-1)),s(t("input",{type:"date",min:o.body.fechaInicioEntrega,"onUpdate:modelValue":l[10]||(l[10]=e=>o.body.fechaTerminoEntrega=e),class:"input input-bordered w-full max-w-xs"},null,8,Ne),[[m,o.body.fechaTerminoEntrega]])]),t("label",je,[l[27]||(l[27]=t("div",{class:"label"},[t("span",{class:"label-text"},"Convocatoria")],-1)),s(t("input",{type:"text","onUpdate:modelValue":l[11]||(l[11]=e=>o.body.convocatoria=e),placeholder:"TECNM",class:x(["input input-bordered w-full max-w-xs",{"input-error":o.validator.setErrorObject(o.addProyecto.error.value).setField("convocatoria").getValidator().isError()}])},null,2),[[m,o.body.convocatoria],[g]])]),t("div",Ae,[t("div",Oe,[l[28]||(l[28]=t("span",{class:"label-text"},"Miembros colaboradores",-1)),o.noMiembrosColab?(b(),f("span",qe,"**")):G("",!0)]),d(o.MultiSelect,{modelValue:o.body.miembrosColaboradores,"onUpdate:modelValue":l[12]||(l[12]=e=>o.body.miembrosColaboradores=e),display:"chip",options:o.miembros?.response,optionLabel:"nombreCompleto","option-value":"idmiembro",filter:"",placeholder:"Selecciona uno o m치s miembros","max-selected-labels":2,class:x({"input-error":o.noMiembrosColab||o.validator.setErrorObject(o.addProyecto.error.value).setField("miembrosColaboradores").getValidator().isError()})},null,8,["modelValue","options","class"])]),t("button",{type:"submit",class:"btn btn-primary",disabled:o.addProyecto.isPending.value},"A침adir proyecto",8,Be)],32),d(o.ListaProyectos,{data:o.proyectos,mutationUpdate:o.updateProyecto,"is-pending":o.isPending,miembros:o.miembros?.response??[],refetch:o.refetch},null,8,["data","mutationUpdate","is-pending","miembros","refetch"])],64)}const oo=O(Ce,[["render",Le]]);export{oo as default};
