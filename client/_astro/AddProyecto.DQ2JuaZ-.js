import{d as k,b as h,e as z,j as q,y as B,o as c,c as p,n as d,k as L,l as n,w as i,a as t,g as m,t as b,p as f,v as g,m as u,F as E,r as N,f as M,K as Y,L as F,s as K,i as G,x as H}from"./index.KfEE4HSd.js";import{a as I,u as T}from"./http.DBesh0fB.js";import{s as j,v as R}from"./index.BmYimniB.js";import{a as J,s as Q}from"./index.DnwL9gBf.js";import{s as W}from"./index.lhl9VIW-.js";import{f as X,a as Z}from"./format.DImkLxIw.js";/* empty css                       */import{_ as A}from"./_plugin-vue_export-helper.DlAUqK2U.js";import"./utils.DAH0eC5i.js";import"./index.BxwS7znj.js";import"./moment.C5S46NFB.js";const $=k({__name:"ListaProyectos",props:{data:{},isPending:{type:Boolean},mutationUpdate:{},miembros:{},refetch:{}},setup(D,{expose:l}){l();const x=D,o=h(null),y=h(!1),v=h([{label:"Eliminar",icon:"bi bi-trash-fill",command:()=>{}}]),e=z(()=>x?.miembros.map(s=>({label:s.nombreCompleto,value:s.idmiembro}))??[]),a=h([]),r=s=>{e:{const{data:w,newValue:S,field:C}=s;if(C==="miembrosCol"){if(w[C]!==F(a.value)){const U=new Set(w[C]),_=new Set(F(a.value)),P=U.difference(_),O=_.difference(U);x.mutationUpdate.mutate({idproyecto:w.idproyecto,miembrosColabAdd:Array.from(O),miembrosColabDelete:Array.from(P)})}break e}S!==w[C]&&x.mutationUpdate.mutate({idproyecto:w.idproyecto,[C]:S});break e}};q(()=>{y.value=!0}),B(()=>{y.value=!1});const V={props:x,selectedItem:o,isMounted:y,items:v,miembros:e,colaboradores:a,handleEdit:r,get DataTable(){return J},get Column(){return Q},get MultiSelect(){return j},get ContextMenu(){return W},get formatDate(){return X},get formatMoneda(){return Z}};return Object.defineProperty(V,"__isScriptSetup",{enumerable:!1,value:!0}),V}}),ee={key:0,class:"skeleton h-96 w-full"},oe=["onUpdate:modelValue"],te={class:"w-60"},le=["onUpdate:modelValue"],ae=["onUpdate:modelValue"],re=["onUpdate:modelValue"],ne=["value"],se={class:"flex gap-4 items-center mb-4"},ie=["onSubmit"],de=["onSubmit"],me=["onUpdate:modelValue"],be=["onUpdate:modelValue"],ce=["onUpdate:modelValue"],ue=["onUpdate:modelValue"],pe=["onUpdate:modelValue"],fe=["onUpdate:modelValue","min"],xe=["onUpdate:modelValue"],ye=["onUpdate:modelValue"],ve=["onUpdate:modelValue","min"];function we(D,l,x,o,y,v){return c(),p(E,null,[d(o.ContextMenu,{ref:"cm",model:o.items,onHide:l[0]||(l[0]=e=>o.selectedItem=null)},null,8,["model"]),o.isMounted?(c(),L(o.DataTable,{key:1,class:f({"skeleton select-none":o.props.isPending,"cursor-wait select-none":o.props.mutationUpdate.isPending.value}),value:o.props.data,paginator:!0,rows:5,"edit-mode":"cell",onCellEditComplete:o.handleEdit},{default:n(()=>[d(o.Column,{field:"clave",header:"Clave del proyecto",sortable:""},{editor:n(({data:e,field:a})=>[i(t("input",{"onUpdate:modelValue":r=>e[a]=r,type:"text",class:"input input-bordered w-full max-w-xs"},null,8,oe),[[m,e[a]]])]),_:1}),d(o.Column,{field:"titulo",header:"Titulo del proyecto"},{body:n(({data:e,field:a})=>[t("div",te,b(e[a]),1)]),editor:n(({data:e,field:a})=>[i(t("textarea",{"onUpdate:modelValue":r=>e[a]=r,class:"textarea textarea-bordered h-24"},null,8,le),[[m,e[a]]])]),_:1}),d(o.Column,{field:"tipo",header:"Tipo de proyecto",sortable:""},{body:n(({data:e,field:a})=>[t("div",{class:f(["badge h-max",{"badge-accent":e[a]==="externo","badge-info":e[a]!=="externo"}])},b(e[a].toUpperCase()),3)]),editor:n(({data:e,field:a})=>[i(t("select",{"onUpdate:modelValue":r=>e[a]=r,class:"select select-bordered w-full max-w-xs"},l[4]||(l[4]=[t("option",{disabled:"",selected:""},"Selecciona un tipo",-1),t("option",{value:"interno"},"Interno",-1),t("option",{value:"externo"},"Externo",-1)]),8,ae),[[g,e[a]]])]),_:1}),d(o.Column,{field:"director",header:"Director(a) responsable del proyecto"},{body:n(({data:e})=>[u(b(e.director_proyecto.nombreCompleto),1)]),editor:n(({data:e,field:a})=>[i(t("select",{"onUpdate:modelValue":r=>e[a]=r,class:"select select-bordered w-full max-w-xs"},[l[5]||(l[5]=t("option",{disabled:"",selected:"",value:""},"Selecciona un miembro",-1)),(c(!0),p(E,null,N(o.props.miembros,r=>(c(),p("option",{value:r.idmiembro},b(r.nombreCompleto),9,ne))),256))],8,re),[[g,e[a]]])]),_:1}),d(o.Column,{field:"miembrosCol",header:"Miembros colaboradores"},{body:n(({data:e})=>[u(b(e.miembros_proyecto.map(a=>a.nombreCompleto).join(",")),1)]),editor:n(({data:e,field:a,editorSaveCallback:r,editorCancelCallback:V})=>[t("div",se,[t("form",{onSubmit:M(V,["prevent"])},l[6]||(l[6]=[t("button",{type:"submit",class:"btn btn-error btn-xs"},"Cancelar",-1)]),40,ie),t("form",{onSubmit:M(r,["prevent"])},l[7]||(l[7]=[t("button",{type:"submit",class:"btn btn-primary btn-xs"},"Guardar",-1)]),40,de)]),d(o.MultiSelect,{modelValue:o.colaboradores,"onUpdate:modelValue":l[1]||(l[1]=s=>o.colaboradores=s),onVnodeMounted:s=>o.colaboradores=e[a],options:o.miembros,"option-label":"label","option-value":"value",display:"chip",filter:"",onKeydown:[l[2]||(l[2]=Y(M(()=>{},["stop"]),["enter"])),l[3]||(l[3]=Y(M(()=>{},["stop"]),["escape"]))]},null,8,["modelValue","onVnodeMounted","options"])]),_:1}),d(o.Column,{field:"otrosColaboradores",header:"Otros colaboradores"},{body:n(({data:e,field:a})=>[u(b(e[a]??"---"),1)]),editor:n(({data:e,field:a})=>[i(t("textarea",{"onUpdate:modelValue":r=>e[a]=r,class:"textarea textarea-bordered h-24"},null,8,me),[[m,e[a]]])]),_:1}),d(o.Column,{field:"estatus",header:"Estatus del proyecto",sortable:""},{body:n(({data:e,field:a})=>[t("div",{class:f(["badge h-max",{"badge-warning":e[a]==="en proceso","badge-success":e[a]==="finalizado","badge-error":e[a]==="no finalizado"}])},b(e[a].toUpperCase()),3)]),editor:n(({data:e,field:a})=>[i(t("select",{"onUpdate:modelValue":r=>e[a]=r,class:"select select-bordered w-full max-w-xs"},l[8]||(l[8]=[t("option",{disabled:"",selected:"",value:""},"Selecciona un estatus",-1),t("option",{value:"en proceso"},"En proceso",-1),t("option",{value:"finalizado"},"Finalizado",-1),t("option",{value:"no finalizado"},"No finalizado",-1)]),8,be),[[g,e[a]]])]),_:1}),d(o.Column,{field:"monto",header:"Monto del proyecto",sortable:""},{body:n(({data:e,field:a})=>[u(b(o.formatMoneda(e[a])),1)]),editor:n(({data:e,field:a})=>[i(t("input",{"onUpdate:modelValue":r=>e[a]=r,type:"number",step:"0.01",min:"0",class:"input input-bordered w-full max-w-xs"},null,8,ce),[[m,e[a]]])]),_:1}),d(o.Column,{field:"convocatoria",header:"Convocatoria"},{editor:n(({data:e,field:a})=>[i(t("input",{"onUpdate:modelValue":r=>e[a]=r,type:"text",class:"input input-bordered w-full max-w-xs"},null,8,ue),[[m,e[a]]])]),_:1}),d(o.Column,{field:"fechaInicio",header:"Fecha de inicio del proyecto",sortable:""},{body:n(({data:e,field:a})=>[u(b(o.formatDate(e[a],"DD-MM-YYYY")),1)]),editor:n(({data:e,field:a})=>[i(t("input",{"onUpdate:modelValue":r=>e[a]=r,type:"date",class:"input input-bordered w-full max-w-xs"},null,8,pe),[[m,e[a]]])]),_:1}),d(o.Column,{field:"fechaTermino",header:"Fecha de termino del proyecto",sortable:""},{body:n(({data:e,field:a})=>[u(b(o.formatDate(e[a],"DD-MM-YYYY")),1)]),editor:n(({data:e,field:a})=>[i(t("input",{"onUpdate:modelValue":r=>e[a]=r,type:"date",min:e.fechaInicio,class:"input input-bordered w-full max-w-xs"},null,8,fe),[[m,e[a]]])]),_:1}),d(o.Column,{field:"visible",header:"Visibilidad del proyecto"},{body:n(({data:e,field:a})=>[t("div",{class:f(["badge h-max",{"badge-success":e[a],"badge-error":!e[a]}])},b(e[a]?"Visible":"No visible"),3)]),editor:n(({data:e,field:a})=>[i(t("select",{"onUpdate:modelValue":r=>e[a]=r,class:"select select-bordered w-full max-w-xs"},l[9]||(l[9]=[t("option",{disabled:"",selected:"",value:""},"Selecciona una visibilidad",-1),t("option",{value:!0},"Visible",-1),t("option",{value:!1},"No visible",-1)]),8,xe),[[g,e[a]]])]),_:1}),d(o.Column,{field:"fechaInicioEntrega",header:"Fecha de inicio de entrega final",sortable:""},{body:n(({data:e,field:a})=>[u(b(e[a]?o.formatDate(e[a],"DD-MM-YYYY"):"---"),1)]),editor:n(({data:e,field:a})=>[i(t("input",{"onUpdate:modelValue":r=>e[a]=r,type:"date",class:"input input-bordered w-full max-w-xs"},null,8,ye),[[m,e[a]]])]),_:1}),d(o.Column,{field:"fechaTerminoEntrega",header:"Fecha de termino de entrega final",sortable:""},{body:n(({data:e,field:a})=>[u(b(e[a]?o.formatDate(e[a],"DD-MM-YYYY"):"---"),1)]),editor:n(({data:e,field:a})=>[i(t("input",{"onUpdate:modelValue":r=>e[a]=r,type:"date",min:e.fechaInicioEntrega,class:"input input-bordered w-full max-w-xs"},null,8,ve),[[m,e[a]]])]),_:1}),d(o.Column,{field:"createdAt",header:"Fecha de creación",sortable:""},{body:n(({data:e,field:a})=>[u(b(o.formatDate(e[a],"DD-MM-YYYY")),1)]),_:1}),d(o.Column,{field:"updatedAt",header:"Ultima actualización",sortable:""},{body:n(({data:e,field:a})=>[u(b(o.formatDate(e[a],"DD-MM-YYYY")),1)]),_:1})]),_:1},8,["class","value"])):(c(),p("div",ee))],64)}const ge=A($,[["render",we]]),Ve=k({__name:"AddProyecto",setup(D,{expose:l}){l();const{data:x,isPending:o,refetch:y}=I("proyectos","proyectosData"),v=h(!1),{data:e,isPending:a}=I("miembros","miembrosData"),r=T("proyectos","post",{onSuccess(){y(),s.miembrosColaboradores=[],s.titulo="",s.clave="",s.fechaInicio="",s.fechaTermino="",s.estatus="",s.tipo="",s.otrosColaboradores="",s.director="",s.monto="",s.fechaInicioEntrega="",s.fechaTerminoEntrega="",s.convocatoria=""}}),V=T("proyectos","put",{onSuccess(){y()}}),s=G({miembrosColaboradores:[],titulo:"",clave:"",fechaInicio:"",fechaTermino:"",estatus:"",tipo:"",director:"",monto:"",fechaInicioEntrega:"",fechaTerminoEntrega:"",convocatoria:"",visible:!0}),w=z(()=>x.value?.response.map(_=>({..._,director:_.director_proyecto.idmiembro,miembrosCol:_.miembros_proyecto.map(P=>P.idmiembro)}))??[]),S=new R,U={data:x,isPending:o,refetch:y,noMiembrosColab:v,miembros:e,miembrosIsPending:a,addProyecto:r,updateProyecto:V,body:s,proyectos:w,validator:S,handleSubmit:()=>{e:{if(s.miembrosColaboradores.length>0&&(v.value=!1),s.miembrosColaboradores.length<1){v.value=!0,H.error("No seleccionaste ningun miembro colaborador.");break e}r.mutate(s);break e}},ListaProyectos:ge,get MultiSelect(){return j}};return Object.defineProperty(U,"__isScriptSetup",{enumerable:!1,value:!0}),U}}),Ce={class:"form-control w-full max-w-xs h-full row-span-2"},_e={class:"form-control w-full max-w-xs"},Ue={class:"form-control w-full max-w-xs"},he={class:"form-control w-full max-w-xs"},Me=["min"],Ee={class:"form-control w-full max-w-xs"},De={class:"form-control w-full max-w-xs"},Se={class:"form-control w-full max-w-xs"},Pe={class:"form-control w-full max-w-xs"},Ye={key:0,disabled:"",selected:"",value:""},Fe=["value"],Ie={class:"form-control w-full max-w-xs"},Te={class:"form-control w-full max-w-xs"},ke={class:"form-control w-full max-w-xs"},ze=["min"],Ne={class:"form-control w-full max-w-xs"},je={class:"w-full max-w-xs"},Ae={class:"label"},Oe={key:0,class:"label-text-alt text-error"},qe=["disabled"];function Be(D,l,x,o,y,v){return c(),p(E,null,[t("form",{class:"mb-4 grid grid-cols-4 grid-rows-3 gap-4 items-end",onSubmit:M(o.handleSubmit,["prevent"])},[t("label",Ce,[l[13]||(l[13]=t("div",{class:"label"},[t("span",{class:"label-text"},"Titulo del proyecto")],-1)),i(t("textarea",{"onUpdate:modelValue":l[0]||(l[0]=e=>o.body.titulo=e),class:f(["textarea textarea-bordered h-full",{"textarea-error":o.validator.setErrorObject(o.addProyecto.error.value).setField("titulo").getValidator().isError()}]),required:""},null,2),[[m,o.body.titulo]])]),t("label",_e,[l[14]||(l[14]=t("div",{class:"label"},[t("span",{class:"label-text"},"Clave")],-1)),i(t("input",{type:"text","onUpdate:modelValue":l[1]||(l[1]=e=>o.body.clave=e),class:f(["input input-bordered w-full max-w-xs",{"input-error":o.validator.setErrorObject(o.addProyecto.error.value).setField("clave").getValidator().isError()}]),required:""},null,2),[[m,o.body.clave]])]),t("label",Ue,[l[15]||(l[15]=t("div",{class:"label"},[t("span",{class:"label-text"},"Fecha de inicio")],-1)),i(t("input",{type:"date","onUpdate:modelValue":l[2]||(l[2]=e=>o.body.fechaInicio=e),class:"input input-bordered w-full max-w-xs",required:""},null,512),[[m,o.body.fechaInicio]])]),t("label",he,[l[16]||(l[16]=t("div",{class:"label"},[t("span",{class:"label-text"},"Fecha de termino")],-1)),i(t("input",{type:"date",min:o.body.fechaInicio,"onUpdate:modelValue":l[3]||(l[3]=e=>o.body.fechaTermino=e),class:"input input-bordered w-full max-w-xs"},null,8,Me),[[m,o.body.fechaTermino]])]),t("label",Ee,[l[17]||(l[17]=t("div",{class:"label"},[t("span",{class:"label-text"},"Monto del proyecto")],-1)),i(t("input",{type:"number",placeholder:"50.00",step:"0.01",min:"0.00","onUpdate:modelValue":l[4]||(l[4]=e=>o.body.monto=e),class:"input input-bordered w-full max-w-xs",required:""},null,512),[[m,o.body.monto]])]),t("label",De,[l[19]||(l[19]=t("div",{class:"label"},[t("span",{class:"label-text"},"Estatus")],-1)),i(t("select",{class:"select select-bordered","onUpdate:modelValue":l[5]||(l[5]=e=>o.body.estatus=e),required:""},l[18]||(l[18]=[t("option",{disabled:"",selected:"",value:""},"Selecciona un estatus",-1),t("option",{value:"en proceso"},"En proceso",-1),t("option",{value:"finalizado"},"Finalizado",-1),t("option",{value:"no finalizado"},"No finalizado",-1)]),512),[[g,o.body.estatus]])]),t("label",Se,[l[21]||(l[21]=t("div",{class:"label"},[t("span",{class:"label-text"},"Tipo de proyecto")],-1)),i(t("select",{class:"select select-bordered","onUpdate:modelValue":l[6]||(l[6]=e=>o.body.tipo=e),required:""},l[20]||(l[20]=[t("option",{disabled:"",selected:"",value:""},"Selecciona un tipo",-1),t("option",{value:"interno"},"Interno",-1),t("option",{value:"externo"},"Externo",-1)]),512),[[g,o.body.tipo]])]),t("label",Pe,[l[23]||(l[23]=t("div",{class:"label"},[t("span",{class:"label-text"},"Director")],-1)),i(t("select",{class:f(["select select-bordered",{skeleton:o.miembrosIsPending}]),"onUpdate:modelValue":l[7]||(l[7]=e=>o.body.director=e),required:""},[o.miembrosIsPending?(c(),p("option",Ye," Cargando miembros... ")):(c(),p(E,{key:1},[l[22]||(l[22]=t("option",{disabled:"",selected:"",value:""},"Selecciona un miembro",-1)),(c(!0),p(E,null,N(o.miembros.response,e=>(c(),p("option",{value:e.idmiembro},b(e.nombreCompleto),9,Fe))),256))],64))],2),[[g,o.body.director]])]),t("label",Ie,[l[24]||(l[24]=t("div",{class:"label"},[t("span",{class:"label-text"},"Otros colaboradores"),t("span",{class:"label-text-alt"},'Separar con ";"')],-1)),i(t("input",{type:"text","onUpdate:modelValue":l[8]||(l[8]=e=>o.body.otrosColaboradores=e),class:f(["input input-bordered w-full max-w-xs",{"input-error":o.validator.setErrorObject(o.addProyecto.error.value).setField("otrosColaboradores").getValidator().isError()}])},null,2),[[m,o.body.otrosColaboradores]])]),t("label",Te,[l[25]||(l[25]=t("div",{class:"label"},[t("span",{class:"label-text"},"Fecha de inicio de entrega")],-1)),i(t("input",{type:"date","onUpdate:modelValue":l[9]||(l[9]=e=>o.body.fechaInicioEntrega=e),class:"input input-bordered w-full max-w-xs"},null,512),[[m,o.body.fechaInicioEntrega]])]),t("label",ke,[l[26]||(l[26]=t("div",{class:"label"},[t("span",{class:"label-text"},"Fecha de termino de entrega")],-1)),i(t("input",{type:"date",min:o.body.fechaInicioEntrega,"onUpdate:modelValue":l[10]||(l[10]=e=>o.body.fechaTerminoEntrega=e),class:"input input-bordered w-full max-w-xs"},null,8,ze),[[m,o.body.fechaTerminoEntrega]])]),t("label",Ne,[l[27]||(l[27]=t("div",{class:"label"},[t("span",{class:"label-text"},"Convocatoria")],-1)),i(t("input",{type:"text","onUpdate:modelValue":l[11]||(l[11]=e=>o.body.convocatoria=e),placeholder:"TECNM",class:f(["input input-bordered w-full max-w-xs",{"input-error":o.validator.setErrorObject(o.addProyecto.error.value).setField("convocatoria").getValidator().isError()}])},null,2),[[m,o.body.convocatoria]])]),t("div",je,[t("div",Ae,[l[28]||(l[28]=t("span",{class:"label-text"},"Miembros colaboradores",-1)),o.noMiembrosColab?(c(),p("span",Oe,"**")):K("",!0)]),d(o.MultiSelect,{modelValue:o.body.miembrosColaboradores,"onUpdate:modelValue":l[12]||(l[12]=e=>o.body.miembrosColaboradores=e),display:"chip",options:o.miembros?.response,optionLabel:"nombreCompleto","option-value":"idmiembro",filter:"",placeholder:"Selecciona uno o más miembros","max-selected-labels":2,class:f({"input-error":o.noMiembrosColab||o.validator.setErrorObject(o.addProyecto.error.value).setField("miembrosColaboradores").getValidator().isError()})},null,8,["modelValue","options","class"])]),t("button",{type:"submit",class:"btn btn-primary",disabled:o.addProyecto.isPending.value},"Añadir proyecto",8,qe)],32),d(o.ListaProyectos,{data:o.proyectos,mutationUpdate:o.updateProyecto,"is-pending":o.isPending,miembros:o.miembros?.response??[],refetch:o.refetch},null,8,["data","mutationUpdate","is-pending","miembros","refetch"])],64)}const eo=A(Ve,[["render",Be]]);export{eo as default};
